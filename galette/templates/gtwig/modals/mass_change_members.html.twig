{% extends (mode == 'ajax') ? "ajax.html.twig" : "page.html.twig" %}

{% block content %}
    <div id="mass_change"{% if mode != 'ajax' %} class="center"{% else %} class="ui modal" title="{{ page_title }}"{% endif %}>
    {% if mode == 'ajax' %}
        <div class="content scrolling">
    {% endif %}
            <form action="{{ form_url }}" method="post" class="ui form">
                {% if mode != 'ajax' %}<h2>{{ page_title }}</h2>{% endif %}
            {% if changes is not defined %}
                <p>{{ _T("Only checked fields will be updated.") }}</p>
                {# Form entries #}
                {% include "components/form.html.twig" with { masschange: true } %}
                {# Dynamic entries #}
                {% include "components/dynamic_fields.html.twig" with { object: member, masschange: true} %}
            {% else %}
                <p>{{ _T("You are about to proceed following changes for selected members:") }}</p>
                <ul>
                {foreach $changes as $field => $change}
                    {assign var="display_value" value=$change.value}
                    {if $field eq 'id_statut'}
                        {assign var="display_value" value=$statuts[$display_value]}
                    {/if}
                    {if $field eq 'titre_adh'}
                        {assign var="display_value" value=$titles_list[$display_value]->long}
                    {/if}
                    {if $field eq 'sexe_adh'}
                        {if $display_value eq {Galette\Entity\Adherent::NC}}
                            {assign var="display_value" value={{ _T("Unspecified") }}}
                        {/if}
                        {if $display_value eq {Galette\Entity\Adherent::WOMAN}}
                            {assign var="display_value" value={{ _T("Woman") }}}
                        {/if}
                        {if $display_value eq {Galette\Entity\Adherent::MAN}}
                            {assign var="display_value" value={{ _T("Man") }}}
                        {/if}
                    {/if}
                    <li>
                        <input type="hidden" name="{{ field }}" value="{{ change.value }}"/>
                        {{ change.label }} {{ display_value }}
                    </li>
                {/foreach}
                </ul>
            {% endif %}
                <div class="button-container">
                    <input type="submit" id="masschange" class="ui button" value="{% if changes is not defined %}{{ _T("Edit") }}{% else %}{{ _T("OK") }}{% endif %}"/>
                    <a href="{{ cancel_uri }}" class="ui button" id="btncancel">{{ _T("Cancel") }}</a>
                    <input type="hidden" name="confirm" value="1"/>
                    {% if mode == 'ajax' %}<input type="hidden" name="ajax" value="true"/>{% endif %}
                    {% for key, value in data %}
                        {% if value is iterable %}
                            {% for val in value %}
                        <input type="hidden" name="{{ key }}[]" value="{{ val }}"/>
                            {% endfor %}
                        {% else %}
                        <input type="hidden" name="{{ key }}" value="{{ value }}"/>
                        {% endif %}
                    {% endfor %}
                    {% include "components/forms/csrf.html.twig" %}
                </div>
            </form>
    {% if mode == 'ajax' %}
        </div>
    {% endif %}
    </div>
{% endblock %}
